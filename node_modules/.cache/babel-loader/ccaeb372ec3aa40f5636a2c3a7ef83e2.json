{"ast":null,"code":"import _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport _Object$entries from \"@babel/runtime-corejs2/core-js/object/entries\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport * as actionTypes from './actionTypes';\nimport axios from '../../services/axios/axios-user';\nimport ability from '../../shared/ability';\nexport var authStart = function authStart() {\n  return {\n    type: actionTypes.AUTH_START\n  };\n};\nexport var authSuccess = function authSuccess(userId, username) {\n  return {\n    type: actionTypes.AUTH_SUCCESS,\n    userId: userId,\n    username: username\n  };\n};\nexport var authFail = function authFail(error) {\n  return {\n    type: actionTypes.AUTH_FAIL,\n    error: error\n  };\n};\nexport var authLogout = function authLogout() {\n  return {\n    type: actionTypes.AUTH_LOGOUT\n  };\n};\nexport var logout = function logout() {\n  return function (dispatch) {\n    return new _Promise(function (resolve, reject) {\n      var url = '/oauth/revoke';\n      resolve(axios.post(url).then(function (response) {\n        sessionStorage.removeItem('token');\n        localStorage.removeItem('username');\n        localStorage.removeItem('userId');\n        ability.update([]);\n        dispatch(authLogout());\n      }));\n    });\n  };\n};\nexport var auth = function auth(username, password) {\n  return function (dispatch) {\n    dispatch(authStart());\n    var authData = {\n      username: username,\n      password: password // grant_type: 'password',\n      // client_id: process.env.CLIENT_ID,\n      // client_secret: process.env.CLIENT_SECRET,\n\n    };\n    var url = '/oauth/token';\n    axios.post(url, authData).then(function (response) {\n      sessionStorage.setItem('token', response.data.access_token);\n      localStorage.setItem('username', response.data.username);\n      localStorage.setItem('userId', response.data.userId);\n      console.log(response);\n      ability.update(response.data.rules);\n      dispatch(authSuccess(response.data.userId, response.data.username));\n    }).catch(function (err) {\n      var errorData = [];\n      var error = {};\n      console.log('auth error', err.response);\n\n      _Object$entries(err.response.data.errors).forEach(function (_ref) {\n        var _ref2 = _slicedToArray(_ref, 2),\n            key = _ref2[0],\n            value = _ref2[1];\n\n        /* eslint prefer-destructuring: [\"error\", {VariableDeclarator: {object: true}}] */\n        error[key] = value[0];\n        errorData.push(error);\n      });\n\n      dispatch(authFail(errorData[0]));\n    });\n  };\n};","map":{"version":3,"sources":["/home/developer/Projects/jetter/client/store/actions/auth.js"],"names":["actionTypes","axios","ability","authStart","type","AUTH_START","authSuccess","userId","username","AUTH_SUCCESS","authFail","error","AUTH_FAIL","authLogout","AUTH_LOGOUT","logout","dispatch","resolve","reject","url","post","then","response","sessionStorage","removeItem","localStorage","update","auth","password","authData","setItem","data","access_token","console","log","rules","catch","err","errorData","errors","forEach","key","value","push"],"mappings":";;;AAAA,OAAO,KAAKA,WAAZ,MAA6B,eAA7B;AACA,OAAOC,KAAP,MAAkB,iCAAlB;AACA,OAAOC,OAAP,MAAoB,sBAApB;AAEA,OAAO,IAAMC,SAAS,GAAG,SAAZA,SAAY,GAAM;AAC7B,SAAO;AACLC,IAAAA,IAAI,EAAEJ,WAAW,CAACK;AADb,GAAP;AAGD,CAJM;AAMP,OAAO,IAAMC,WAAW,GAAG,SAAdA,WAAc,CAACC,MAAD,EAASC,QAAT,EAAsB;AAC/C,SAAO;AACLJ,IAAAA,IAAI,EAAEJ,WAAW,CAACS,YADb;AAELF,IAAAA,MAAM,EAAEA,MAFH;AAGLC,IAAAA,QAAQ,EAAEA;AAHL,GAAP;AAKD,CANM;AAQP,OAAO,IAAME,QAAQ,GAAG,SAAXA,QAAW,CAACC,KAAD,EAAW;AACjC,SAAO;AACLP,IAAAA,IAAI,EAAEJ,WAAW,CAACY,SADb;AAELD,IAAAA,KAAK,EAAEA;AAFF,GAAP;AAID,CALM;AAOP,OAAO,IAAME,UAAU,GAAG,SAAbA,UAAa,GAAM;AAC9B,SAAO;AACLT,IAAAA,IAAI,EAAEJ,WAAW,CAACc;AADb,GAAP;AAGD,CAJM;AAMP,OAAO,IAAMC,MAAM,GAAG,SAATA,MAAS;AAAA,SAAM,UAAAC,QAAQ;AAAA,WAAI,aAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACvE,UAAMC,GAAG,GAAG,eAAZ;AAEAF,MAAAA,OAAO,CACLhB,KAAK,CAACmB,IAAN,CAAWD,GAAX,EACGE,IADH,CACQ,UAAAC,QAAQ,EAAI;AAChBC,QAAAA,cAAc,CAACC,UAAf,CAA0B,OAA1B;AACAC,QAAAA,YAAY,CAACD,UAAb,CAAwB,UAAxB;AACAC,QAAAA,YAAY,CAACD,UAAb,CAAwB,QAAxB;AACAtB,QAAAA,OAAO,CAACwB,MAAR,CAAe,EAAf;AAEAV,QAAAA,QAAQ,CAACH,UAAU,EAAX,CAAR;AACD,OARH,CADK,CAAP;AAWD,KAduC,CAAJ;AAAA,GAAd;AAAA,CAAf;AAgBP,OAAO,IAAMc,IAAI,GAAG,SAAPA,IAAO,CAACnB,QAAD,EAAWoB,QAAX,EAAwB;AAC1C,SAAO,UAAAZ,QAAQ,EAAI;AACjBA,IAAAA,QAAQ,CAACb,SAAS,EAAV,CAAR;AAEA,QAAM0B,QAAQ,GAAG;AACfrB,MAAAA,QAAQ,EAAEA,QADK;AAEfoB,MAAAA,QAAQ,EAAEA,QAFK,CAGf;AACA;AACA;;AALe,KAAjB;AAQA,QAAMT,GAAG,GAAG,cAAZ;AAEAlB,IAAAA,KAAK,CAACmB,IAAN,CAAWD,GAAX,EAAgBU,QAAhB,EACGR,IADH,CACQ,UAAAC,QAAQ,EAAI;AAChBC,MAAAA,cAAc,CAACO,OAAf,CAAuB,OAAvB,EAAgCR,QAAQ,CAACS,IAAT,CAAcC,YAA9C;AACAP,MAAAA,YAAY,CAACK,OAAb,CAAqB,UAArB,EAAiCR,QAAQ,CAACS,IAAT,CAAcvB,QAA/C;AACAiB,MAAAA,YAAY,CAACK,OAAb,CAAqB,QAArB,EAA+BR,QAAQ,CAACS,IAAT,CAAcxB,MAA7C;AACA0B,MAAAA,OAAO,CAACC,GAAR,CAAYZ,QAAZ;AACApB,MAAAA,OAAO,CAACwB,MAAR,CAAeJ,QAAQ,CAACS,IAAT,CAAcI,KAA7B;AACAnB,MAAAA,QAAQ,CAACV,WAAW,CAClBgB,QAAQ,CAACS,IAAT,CAAcxB,MADI,EAElBe,QAAQ,CAACS,IAAT,CAAcvB,QAFI,CAAZ,CAAR;AAID,KAXH,EAYG4B,KAZH,CAYS,UAAAC,GAAG,EAAI;AACZ,UAAMC,SAAS,GAAG,EAAlB;AACA,UAAM3B,KAAK,GAAG,EAAd;AACAsB,MAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0BG,GAAG,CAACf,QAA9B;;AACA,sBAAee,GAAG,CAACf,QAAJ,CAAaS,IAAb,CAAkBQ,MAAjC,EAAyCC,OAAzC,CAAiD,gBAAkB;AAAA;AAAA,YAAhBC,GAAgB;AAAA,YAAXC,KAAW;;AACjE;AACA/B,QAAAA,KAAK,CAAC8B,GAAD,CAAL,GAAaC,KAAK,CAAC,CAAD,CAAlB;AACAJ,QAAAA,SAAS,CAACK,IAAV,CAAehC,KAAf;AACD,OAJD;;AAMAK,MAAAA,QAAQ,CAACN,QAAQ,CAAC4B,SAAS,CAAC,CAAD,CAAV,CAAT,CAAR;AACD,KAvBH;AAwBD,GArCD;AAsCD,CAvCM","sourcesContent":["import * as actionTypes from './actionTypes';\nimport axios from '../../services/axios/axios-user';\nimport ability from '../../shared/ability';\n\nexport const authStart = () => {\n  return {\n    type: actionTypes.AUTH_START\n  }\n}\n\nexport const authSuccess = (userId, username) => {\n  return {\n    type: actionTypes.AUTH_SUCCESS,\n    userId: userId,\n    username: username,\n  }\n}\n\nexport const authFail = (error) => {\n  return {\n    type: actionTypes.AUTH_FAIL,\n    error: error\n  }\n}\n\nexport const authLogout = () => {\n  return {\n    type: actionTypes.AUTH_LOGOUT,\n  }\n}\n\nexport const logout = () => dispatch => new Promise((resolve, reject) => { \n  const url = '/oauth/revoke';\n  \n  resolve(\n    axios.post(url)\n      .then(response => {\n        sessionStorage.removeItem('token');\n        localStorage.removeItem('username');\n        localStorage.removeItem('userId');\n        ability.update([]);\n        \n        dispatch(authLogout());\n      })\n  );\n});\n\nexport const auth = (username, password) => {\n  return dispatch => {\n    dispatch(authStart());\n\n    const authData = {\n      username: username,\n      password: password,\n      // grant_type: 'password',\n      // client_id: process.env.CLIENT_ID,\n      // client_secret: process.env.CLIENT_SECRET,\n    }\n\n    const url = '/oauth/token';\n\n    axios.post(url, authData)\n      .then(response => {\n        sessionStorage.setItem('token', response.data.access_token);\n        localStorage.setItem('username', response.data.username);\n        localStorage.setItem('userId', response.data.userId);\n        console.log(response)\n        ability.update(response.data.rules);\n        dispatch(authSuccess(\n          response.data.userId, \n          response.data.username, \n        ));\n      })\n      .catch(err => {\n        const errorData = [];\n        const error = {};\n        console.log('auth error', err.response)\n        Object.entries(err.response.data.errors).forEach(([key, value]) => {\n          /* eslint prefer-destructuring: [\"error\", {VariableDeclarator: {object: true}}] */\n          error[key] = value[0];\n          errorData.push(error)\n        });\n\n        dispatch(authFail(errorData[0]));\n      })\n  }\n}\n"]},"metadata":{},"sourceType":"module"}